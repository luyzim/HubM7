<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>CCS-FortiGate–MPLS</title>
<link rel="icon" type="image/png" href="https://i.imgur.com/8qVGalo.png">
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
  body {
    font-family: 'Inter', sans-serif;
    background-image: url('https://images.unsplash.com/photo-1749150270018-1dee5a5e4b88?q=80&w=1170&auto=format&fit=crop');
    background-size: cover;
    background-repeat: no-repeat;
    background-position: center;
    background-attachment: fixed;
  }
  .content-box {
    background-color: rgba(30, 41, 59, 0.75);
    backdrop-filter: blur(4px);
    border-radius: 0.75rem;
    padding: 2rem;
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    color: white;
    width: 90%;
    max-width: 900px;
    margin: 2rem auto;
  }
  input, select, button {
    background-color: #E5E7EB;
    color: #000;
    border-radius: 0.375rem;
    padding: 0.5rem 0.75rem;
    border: 1px solid #2672e4;
    width: 100%;
  }
  label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 500;
    color: #9CA3AF;
  }
  button {
    background-color: #3B82F6;
    color: white;
    font-weight: 600;
  }
  button:hover {
    background-color: #2563EB;
  }
  pre {
    background-color: #1F2937;
    border: 1px solid #4B5563;
    padding: 1rem;
    border-radius: 0.5rem;
    overflow-x: auto;
    color: #E5E7EB;
    min-height: 120px;
  }
  .grid-container {
    display: grid;
    grid-template-columns: repeat(1, 1fr);
    gap: 1.5rem;
  }
  @media (min-width: 768px) {
    .grid-container {
      grid-template-columns: repeat(3, 1fr);
    }
  }
</style>
</head>

<body class="p-6">

<div class="content-box">

  <div class="flex justify-between items-start mb-6">
    <div>
      <h1 class="text-3xl font-bold">CCS-FortiGate – MPLS</h1>
      <p class="text-gray-400">Gere o arquivo de configuração do FortiGate apartir dos dados fornecidos.</p>
    </div>
    <a href="/home" class="bg-gray-600 px-4 py-2 rounded hover:bg-gray-500">Voltar</a>
  </div>

  <form id="form">
    <div class="grid-container">
      <label>
        Singular (ex: CREDIMOGIANA)
        <input name="SINGULAR" required placeholder="CREDIMOGIANA">
      </label>

      <label>
        VRF
        <select name="VRF" required>
          <option value="INTERNET">INTERNET</option>
          <option value="MPLS">MPLS</option>
        </select>
      </label>

      <label>
        Número do PA (ex: 09)
        <input name="NUM_PA" required placeholder="09">
      </label>
      
      <label>
        IP da WAN (ex: 172.27.146.98/30)
        <input name="WAN_IP" required placeholder="172.27.146.98">
      </label>

      <label>
        IP Privado (ex: 201.33.116.19/31)
        <input name="IP_PRIVADO" required placeholder="201.33.116.19">
      </label>
    </div>

    <div class="mt-6">
      <button type="submit" class="py-3 w-full">
        Gerar Configuração FortiGate
      </button>
    </div>

  </form>

  <h3 class="text-2xl font-semibold mt-8 mb-3">Preview do arquivo .conf</h3>
  <pre id="out">Nenhuma configuração gerada.</pre>

</div>

<script type="module">
  const form = document.getElementById("form");

  const collectData = () =>
    Object.fromEntries(new FormData(form).entries());

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    const out = document.getElementById("out");
    out.textContent = "Gerando configuração...";

    const response = await fetch("/api/ccsFortgate", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ data: collectData() })
    });

    const payload = await response.json();

    if (!payload.ok) {
        out.textContent = `Erro:\n${payload.error || JSON.stringify(payload, null, 2)}`;
        return;
    }
    
    const content = payload.raw;
    const blob = new Blob([content], { type: "text/plain;charset=utf-8" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = payload.filename || "download.conf";
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);

    out.textContent = `Arquivo ${a.download} gerado com sucesso.\n\n${content}`;
  });
</script>

</body>
</html>