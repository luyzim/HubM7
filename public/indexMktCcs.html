<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>MKT - CCS</title>
<link rel="icon" type="image/png" href="https://i.imgur.com/8qVGalo.png">
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
    body {
        font-family: 'Inter', sans-serif;
        background-image: url('https://images.unsplash.com/photo-1749150270018-1dee5a5e4b88?q=80&w=1170&auto=format&fit=crop&ixlibrb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D');
        background-size: cover;
        background-repeat: no-repeat;
        background-position: center;
        background-attachment: fixed;
    }
    .content-box {
        background-color: rgba(30, 41, 59, 0.75);
        backdrop-filter: blur(4px);
        border-radius: 0.75rem;
        padding: 2rem;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        color: white;
        width: 90%;
        max-width: 900px;
        margin: 2rem auto;
    }
    input, select, button, textarea {
        background-color: #E5E7EB;
        color: #111827;
        border-radius: 0.375rem;
        padding: 0.5rem 0.75rem;
        border: 1px solid #D1D5DB;
        width: 100%;
    }
    input::placeholder, textarea::placeholder { color: #9ca3af; }
    input:focus, select:focus, textarea:focus {
        outline: 2px solid transparent;
        outline-offset: 2px;
        border-color: #4F46E5;
        box-shadow: 0 0 0 2px #4F46E5;
        background-color: #F9FAFB;
    }
    label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 500;
        color: #D1D5DB;
    }
    button {
        background-color: #3B82F6;
        color: white;
        font-weight: 600;
        transition: background-color 0.2s ease-in-out;
        cursor: pointer;
    }
    button:hover { background-color: #2563EB; }
    .btn-voltar {
        background-color: #4B5563;
        color: white;
        text-decoration: none;
        padding: 0.5rem 1rem;
        border-radius: 0.375rem;
        display: inline-block;
        transition: background-color 0.2s ease-in-out;
        font-weight: 500;
        font-size: 0.875rem;
        line-height: 1.25rem;
    }
    .btn-voltar:hover { background-color: #6B7280; }
    pre {
        background-color: #1F2937;
        border: 1px solid #4B5563;
        padding: 0.75rem;
        border-radius: 0.5rem;
        overflow-x: auto;
        color: #E5E7EB;
        min-height: 80px;
    }
    #result-buttons button,
    #out-buttons button,
    #msg-out-buttons button {
        background-color: #10B981;
        font-size: 0.875rem;
        padding: 0.5rem 1rem;
    }
    #result-buttons button:hover,
    #out-buttons button:hover,
    #msg-out-buttons button:hover { background-color: #059669; }
    #result-buttons button:last-child,
    #out-buttons button:last-child,
    #msg-out-buttons button:last-child {
        background-color: #0EA5E9;
    }
    #result-buttons button:last-child:hover,
    #out-buttons button:last-child:hover,
    #msg-out-buttons button:last-child:hover { background-color: #0284C7; }

    .help-fab {
      position: fixed; right: 24px; bottom: 24px;
      width: 44px; height: 44px; border-radius: 999px;
      border: 1px solid #3a3a3a; background:#1a1a1d; color:#eee;
      font-weight: 700; cursor: pointer;
      display:flex; align-items:center; justify-content:center;
      box-shadow: 0 6px 20px rgba(0,0,0,.35); z-index: 1000;
    }
    .help-fab:focus { outline: 2px solid #3a3a3a; outline-offset: 2px; }

    .help-bubble {
      position: fixed; right: 24px; bottom: 84px;
      max-width: 420px; padding: 14px 16px;
      border-radius: 14px; background:#101014; color:#eee;
      border:1px solid #2a2a2a; box-shadow: 0 14px 40px rgba(0,0,0,.5);
      z-index: 1000; display:none;
    }
    .help-bubble::after {
      content: ""; position:absolute; right: 18px; bottom:-10px;
      border-width:10px; border-style:solid;
      border-color:#101014 transparent transparent transparent;
      filter: drop-shadow(0 -2px 0 #2a2a2a);
    }
    .help-bubble h4 { margin: 0 0 8px 0; font-size: 16px; }
    .help-bubble p  { margin: 6px 0; color:#ccc; line-height:1.35; }
    .help-bubble code { background:#0b0b0c; border:1px solid #222; padding:2px 6px; border-radius:6px; }
    .help-bubble .close {
      position:absolute; top:8px; right:10px; border:0; background:transparent; color:#aaa; cursor:pointer;
      font-size:18px; line-height:1;
    }
    .help-bubble .close:hover { color:#fff; }
</style>
</head>
<body class="p-4 sm:p-6 lg:p-8">

  <div class="content-box">
    <div class="flex justify-between items-start mb-4">
      <div>
        <h1 class="text-3xl font-bold mb-1">Script CCS - Mikrotik</h1>
        <h2 class="text-xl text-gray-300 mb-2">Versao: 7.20</h2>
      </div>
      <div class="flex gap-2">
        <a href="/api/tabela" class="btn-voltar">Tabela</a>
        <a href="/home" class="btn-voltar">Voltar</a>
      </div>
    </div>
      
    <p class="text-gray-400 mb-1">Substitua os campos com os dados referentes</p>
    <p class="text-gray-400 mb-6">Para gerar o arquivo txt com o padrao CCS</p>


    <form id="form" class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">
      <label>PA-: <input name="NUM_PA" required placeholder="07" /></label>
      <label>Cidade: <input name="NOME_PA" required placeholder="ex: Jardinopolis" /></label>
      <label>Identificacao <input name="IDENTIFICACAO" placeholder="ex: CREDIVALE" /></label>
      <label>Parceiro: <input name="PARCEIRO" /></label>
      <label>Ip da Unidade: <input name="IP_UNIDADE" placeholder="ex: 192.168.10.1" /></label>
      <label>Ip Valido:  <input name="IP_VALIDO"  placeholder="ex: 191.5.132.18/31" /></label>
      <label>Login PPPoE: <input name="PPPOE_USER" /></label>
      <label>Senha PPPoE: <input name="PPPOE_PASS" /></label>
      <label>Gary User: <input name="GARY_USER" placeholder="User do l2tp do Gary" /></label>
      <label>Plankton User: <input name="PLANKTON_USER" placeholder="User do l2tp do Plankton"/></label>
      <label>VELOCIDADE: <input name="VELOCIDADE" placeholder="ex: 10M" /></label>
      <label>VRF:
        <select name="VRF" required>
          <option value="">Exemplo: INTERNET</option>
          <option value="MPLS">MPLS</option>
          <option value="INTERNET">INTERNET</option>
        </select>
      </label>  
      
      <label>AS LOCAL: <input name="AS_LOCAL" placeholder="AS Local" /></label>
      <label>AS REMOTO: <input name="AS_REMOTO" placeholder="AS Remoto"/></label>

      <div class="md:col-span-2 flex flex-wrap gap-3 mt-2">
        <button id="btn-config" type="submit" class="py-3 px-4">Gerar Configuracao</button>
        <button id="btn-mensagem" type="button" class="py-3 px-4">Gerar Mensagem (Internet)</button>
      </div>
    </form>

    <h3 class="text-2xl font-semibold mt-8 mb-3">Preview Configuracao</h3>
    <pre id="out" class="full">Nenhum arquivo gerado.</pre>

    <h3 class="text-2xl font-semibold mt-6 mb-3">Mensagem Internet</h3>
    <pre id="msg-out" class="full">Nenhuma mensagem gerada.</pre>
  </div>

<script type="module">
  import { renderResult } from "/result.js";
  const form = document.getElementById("form");
  const btnMensagem = document.getElementById("btn-mensagem");

  const collectData = () => Object.fromEntries(new FormData(form).entries());

  const callApi = async (url, outId, labels = {}) => {
    const data = collectData();
    const response = await fetch(url, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ data })
    });
    const payload = await response.json();
    renderResult(payload, { outId, containerId: `${outId}-buttons`, ...labels });
  };

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    await callApi("/api/mkt", "out", { downloadLabel: "Baixar configuracao" });
  });

  btnMensagem.addEventListener("click", async (e) => {
    e.preventDefault();
    await callApi("/api/mkt/mensagem", "msg-out", {
      previewLabel: "Pre-visualizar mensagem",
      downloadLabel: "Baixar mensagem",
    });
  });

  const helpFab    = document.getElementById("helpFab");
  const helpBubble = document.getElementById("helpBubble");
  const helpClose  = document.getElementById("helpClose");

  if (helpFab && helpBubble && helpClose) {
    const setBubble = (show) => {
      helpBubble.style.display = show ? "block" : "none";
      helpFab.setAttribute("aria-expanded", String(show));
    };

    helpFab.addEventListener("click", () => {
      const open = helpBubble.style.display !== "block";
      setBubble(open);
    });

    helpClose.addEventListener("click", () => setBubble(false));

    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") setBubble(false);
    });
  }
</script>


<button class="help-fab" id="helpFab" aria-controls="helpBubble" aria-expanded="false" title="Instrucoes">?</button>

  <div class="help-bubble" id="helpBubble" role="dialog" aria-labelledby="helpTitle" aria-modal="false">
    <button class="close" id="helpClose" aria-label="Fechar">×</button>
    <h4 id="helpTitle">Instrucoes rapidas</h4>
    <p>- Utilize <code>IP-Valido</code> com o barramento desejado para o calculo automatico.</p>
    <p>- <code>IP_UNIDADE</code> nao precisa de barramento "/".</p>
    <p>- Escolha a <code>VRF</code> conforme o caso: <strong>MPLS</strong> ou <strong>INTERNET</strong>.</p>
    <p>- O campo <strong>IDENTIFICACAO</strong> refere-se ao nome da unidade (ex.: CREDIVALE).</p>
    <p>- Use sempre <code>IP_UNIDADE</code> sem barramento (assumimos /30).</p>
    <p>- IPs do <strong>Gary</strong> e <strong>Plankton</strong> sao calculados a partir do IP da unidade.</p>
    <p>- Em caso de problema ou sugestao acione o <strong>ZIBRINIX</strong>.</p>
  </div>

</body>
</html>


