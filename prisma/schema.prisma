generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model admins {
  id         Int      @id @default(autoincrement())
  email      String   @unique
  name       String
  pass_hash  String
  created_at DateTime @default(now()) @db.Timestamptz(6)
}

model n2 {
  id         Int      @id @default(autoincrement())
  email      String   @unique
  pass_hash  String
  name       String
  created_at DateTime @default(now()) @db.Timestamptz(6)
}

model n1 {
  id         Int      @id @default(autoincrement())
  email      String   @unique
  pass_hash  String
  name       String
  created_at DateTime @default(now()) @db.Timestamptz(6)
}

model monitoramento {
  id         Int      @id @default(autoincrement())
  email      String   @unique
  pass_hash  String
  name       String
  created_at DateTime @default(now()) @db.Timestamptz(6)
}

model itens {
  id         Int      @id @default(autoincrement())
  nome       String
  descricao  String
  quantidade Int
  created_at DateTime @default(now()) @db.Timestamptz(6)
}

model commands_mkt {
  id          Int      @id @default(autoincrement())
  descricao   String
  roles       Json?
  created_at  DateTime @default(now()) @db.Timestamptz(6)
  active      Boolean  @default(true)
  updatedAt   DateTime @updatedAt
  commandText String
  name        String?  @unique
}

model interfaces_mkt {
  id            Int       @id @default(autoincrement())
  interfaceName String
  ip            String
  comentario    String?
  macAddress    String?
  created_at    DateTime  @default(now()) @db.Timestamptz(6)
  updatedAt     DateTime  @updatedAt
  scanId        Int?
  scan          mkt_scan? @relation(fields: [scanId], references: [id])

  ipAddresses   interfaces_ip_address[]

  @@unique([ip, interfaceName], name: "ip_interfaceName")
}

model interfaces_ip_address {
  id           Int      @id @default(autoincrement())
  interfaceId  Int
  address      String
  comment      String?

  interface    interfaces_mkt @relation(fields: [interfaceId], references: [id])

  @@unique([interfaceId, address])
  @@index([address])
}

model vcn_mkt {
  id            Int       @id @default(autoincrement())
  vcn           String
  ip            String
  gateway       String
  gatewayStatus String?
  distance      String
  comentario    String?
  active        Boolean
  created_at    DateTime  @default(now()) @db.Timestamptz(6)
  updatedAt     DateTime  @updatedAt
  scanId        Int?
  dstAddress    String
  mkt_scanId    Int?
  mktScan       mkt_scan? @relation(fields: [mkt_scanId], references: [id])

  @@unique([ip, vcn, dstAddress, gateway, distance], name: "ip_vcn_dst_gateway_distance")
}

model mkt_scan {
  id         Int              @id @default(autoincrement())
  parceiro_gary String
  parceiro_plakton String
  routerIp   String
  created_at DateTime         @default(now()) @db.Timestamptz(6)
  interfaces interfaces_mkt[]
  routes     vcn_mkt[]
}

model WikiTemplate {
  id         Int      @id @default(autoincrement())
  name       String   @unique
  content    String
  editor     String   @default("markdown")
  locale     String   @default("pt-br")
  createdAt  DateTime @default(now()) @db.Timestamptz(6)
  updatedAt  DateTime @updatedAt
}

model WorkSession {
  id          String   @id @default(cuid())
  userEmail   String   // ou userId se você já tiver tabela User
  taskType    String   // ex: "mkt", "cisco", "fortigate", "wiki", etc.
  context     Json?    // ex: { endpoint: "/api/mkt", cliente: "CCS", ip: "..." }
  startedAt   DateTime @default(now())
  stoppedAt   DateTime?
  durationMs  Int?     // setado no stop
  status      String   @default("RUNNING") // RUNNING | STOPPED | ABORTED
  lastPingAt  DateTime @default(now())     // heartbeat opcional

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([userEmail, status])
  @@index([taskType, startedAt])
}
